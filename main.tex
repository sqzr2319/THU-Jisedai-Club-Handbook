\documentclass[twoside,12pt]{book}
\usepackage{fontspec} 
\usepackage[utf8]{inputenc} 
\newfontfamily{\arial}{Arial Unicode MS}
\newfontfamily\EmojiFont{Segoe UI Emoji}[Renderer=Harfbuzz]
\newcommand{\emoji}[1]{{\EmojiFont #1}}
% 默认字体保持LaTeX标准设置
% 中文支持设置
% 使用ctex包但不使用默认字体设置(fontset=none)
\usepackage[fontset=none]{ctex}
% 设置中文字体：宋体为主字体，黑体为粗体，楷体为斜体
\setCJKmainfont{SimSun}[
  BoldFont = SimHei,
  ItalicFont = KaiTi,
  BoldItalicFont = KaiTi
]

% 加载常用包
\usepackage{tcolorbox}  % 彩色文本框支持
\usepackage{ulem}
\tcbuselibrary{skins, breakable}  % 加载tcolorbox的皮肤和断页功能
\usepackage{tikz}  % 绘图支持
\usepackage{graphicx}  % 图片插入支持
\graphicspath{{figures/},{figures/部门1/},{figures/部门2/},{figures/看板/},{figures/头像/},{figures/部酱/},{figures/页眉页脚/}}  % 设置图片路径为figures目录
% 颜色和页面布局设置
\usepackage{xcolor}  % 颜色支持
\usepackage{wrapfig}  % 文字环绕图片支持
\usepackage{floatflt}
\usepackage{eso-pic}  % 页面背景支持
\usepackage{geometry}  % 页面布局设置
\usepackage{setspace}
\usepackage{textcomp}
%\usepackage{showframe}
\usepackage{pifont}
\usepackage{fancyhdr}
\usepackage{comment}
\usepackage{adjustbox}
\usepackage{eso-pic}
\usepackage{ragged2e}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric}
\usepackage{multicol}
\usepackage{enumitem}
\newenvironment{categorysection}[1]{
  \subsection*{\textcolor{truepurple}{#1}}
  \begin{itemize}[leftmargin=*, 
                 nosep,               % 移除所有额外间距
                 itemsep=2pt,         % 条目间距=0
                 parsep=0pt,          % 段落间距=0
                 before=\setlength{\baselineskip}{23pt} % 设置行距
  ]
}{
  \end{itemize}
}
\usetikzlibrary{calc,positioning}
\usetikzlibrary{shapes, arrows}  

\geometry{a4paper, left=1.5cm, right=1.5cm, top=2cm, bottom=2.5cm}
% 设置无衬线中文字体为黑体
\setCJKsansfont{SimHei}

% 定义文档使用的颜色
\definecolor{truepurple}{RGB}{128, 0, 128}  % 主色调紫色
\definecolor{taopink}{HTML}{F17F98}  % 桃子名字
\definecolor{tao}{HTML}{FFF2F9}  % 桃子气泡
\definecolor{zi}{HTML}{F8F2F9}  % 紫荆气泡
\definecolor{qing}{HTML}{F2F9EA}  % 清芬气泡
\definecolor{default}{HTML}{F9F9F9}  %默认气泡灰
% 加载tikz的渐变效果库
\usetikzlibrary{fadings}

% 页面布局设置
\geometry{
  top=1.5cm,       % 从3cm减小到1.5cm
  headheight=20.57637pt, % 解决fancyhdr警告
  headsep=10pt,     % 增加页眉与正文间距
  footskip=30pt     % 增加页脚与正文间距
}

% 定义聊天气泡样式
% 使用说明：
% \chatbubble[位置]{头像路径}{昵称}{消息内容}{背景颜色}
% 可选参数：
% [left] - 左侧气泡（默认）
% [right] - 右侧气泡
% 示例：
% \chatbubble[left]{taozi.png}{桃子}{消息内容}{tao}
% \chatbubble[right]{zijing.png}{紫荆}{消息内容}{zi}
% \chatbubble[right]{qingfen.png}{清芬}{消息内容}{qing}
\newcounter{chatcounter}
\newcommand{\chind}{\hspace*{2em}}
\newcommand{\chatbubble}[5][left]{%
  \stepcounter{chatcounter}%
  \par\noindent%
  \ifstrequal{#1}{left}
    {% 左侧气泡
     \begin{minipage}[t]{1.2cm} % 头像宽度
        \begin{tikzpicture}[baseline=(current bounding box.center)]
          \node[circle, draw=gray!50, line width=0.5pt, minimum size=1.2cm, 
                path picture={\node at (path picture bounding box.center) 
                {\includegraphics[width=1.2cm]{#2}};}] {};
        \end{tikzpicture}
     \end{minipage}%
     \hspace{0.2cm}%
     \begin{minipage}[t]{0.7\textwidth} % 消息框宽度
        \vspace{-15pt} % 确保顶部对齐
        \noindent\textcolor{darkgray!80}{\sffamily #3} % 昵称
        \vspace{5pt}
        \begin{tcolorbox}[
          enhanced,
          breakable=false,
          colback={#5},
          colframe={#5},
          arc=8pt,
          boxrule=0.5pt,
          left=8pt,
          right=8pt,
          top=4pt,
          bottom=4pt,
          before skip=0pt,
          after skip=10pt,
          width=\linewidth,
          before upper={\setlength{\parindent}{0em} \setlength{\parskip}{0pt}},
        ]
          #4
        \end{tcolorbox}
     \end{minipage}
    }
    {% 右侧气泡
     \hfill%
     \begin{minipage}[t]{0.7\textwidth} % 消息框宽度
        \vspace{-15pt} % 确保顶部对齐
        \noindent\hfill\textcolor{darkgray!80}{\sffamily #3} % 右对齐昵称
        \vspace{5pt}
        \hfill%
        \begin{tcolorbox}[
          enhanced,
          breakable=false,
          colback={#5},
          colframe={#5},
          arc=8pt,
          boxrule=0.5pt,
          left=8pt,
          right=8pt,
          top=4pt,
          bottom=4pt,
          before skip=0pt,
          after skip=10pt,
          width=\linewidth,
          before upper={\setlength{\parindent}{0em} \setlength{\parskip}{0pt}},
        ]
          #4
        \end{tcolorbox}
     \end{minipage}%
     \hspace{0.2cm}%
     \begin{minipage}[t]{1.2cm} % 头像宽度
        \begin{tikzpicture}[baseline=(current bounding box.center)]
          \node[circle, draw=gray!50, line width=0.5pt, minimum size=1.2cm, 
                path picture={\node at (path picture bounding box.center) 
                {\includegraphics[width=1.2cm]{#2}};}] {};
        \end{tikzpicture}
     \end{minipage}
    }%
  \par\vspace{0.1cm}% 气泡间距
}
\newcommand{\picbox}[1]{%
\vspace{0.3em}

    \begin{tikzpicture}
        \node[
            trapezium, 
            draw=truepurple, 
            fill=truepurple!80!black, 
            text=white, 
            inner sep=3pt, 
            minimum width=0.8\linewidth, % 宽度为行宽的80%
            minimum height=0.3cm, 
            trapezium left angle=90, % 左边直角
            trapezium right angle=65, % 右边角度
            trapezium stretches=true, % 允许拉伸
            align=left % 文本居左
        ] 
        {#1};
    \end{tikzpicture}%
}
% 设置页眉页脚样式
\pagestyle{fancy}  % 使用fancy页眉页脚样式
\fancyhf{} % 清空所有页眉页脚默认设置

% 设置页眉
% LE: 偶数页左侧页眉
\fancyhead[LE]{\hspace*{-1.5cm}\includegraphics[width=\paperwidth]{head.pdf}} 
% RO: 奇数页右侧页眉
\fancyhead[RO]{\hspace*{-1.5cm}\includegraphics[width=\paperwidth]{headr.pdf}} 
\renewcommand{\headrulewidth}{0pt}  % 移除页眉分隔线
\setlength{\headsep}{5mm}  % 设置页眉与正文间距

% 设置页脚
% LE: 偶数页左侧页脚
\fancyfoot[LE]{\hspace{-0.3cm}\raisebox{-13pt}{\textcolor{white}{\textbf{\textsf{\thepage}}}}} 
% RO: 奇数页右侧页脚
\fancyfoot[RO]{\rlap{\hspace{-0.15cm}\raisebox{-13pt}{\textcolor{white}{\textbf{\textsf{\thepage}}}}}}
\renewcommand{\footrulewidth}{0pt}  % 移除页脚分隔线

% 添加页面背景图片
% 根据奇偶页显示不同的背景图片
\AddToShipoutPictureBG{%
  \ifodd\value{page}
    % 奇数页底部背景
    \AtPageLowerLeft{%
      \raisebox{15pt}[0pt][0pt]{\includegraphics[width=\paperwidth]{footr.pdf}}%
    }
  \else
    % 偶数页底部背景
    \AtPageLowerLeft{%
      \raisebox{15pt}[0pt][0pt]{\includegraphics[width=\paperwidth]{footl.pdf}}%
    }
  \fi
}
% 定义橙色
\definecolor{thuorange}{RGB}{247, 148, 29}

\begin{document}
% 目录页设置
\vspace*{0.7cm}  % 顶部间距
\begin{center}
    % 主标题
    \fontsize{30pt}{32pt}\selectfont
    \textbf{\textcolor{truepurple}{目录}}
    \\[0ex]  % 标题间距
    % 副标题
    \fontsize{18pt}{20pt}\selectfont
    \textcolor{thuorange}{Contents}
\end{center}
% 目录内容
\begin{Large}
\doublespacing  % 双倍行距
社团介绍\\ 
主要活动介绍\\
社团Q\&A\\
分部介绍
\begin{large}
\begin{itemize}
  \item 组织部门
  \item 创作类
  \item 歌舞艺术类
  \item 综合类
  \item 作品类
  \item 游戏类
  \item 娱乐影视类
  \item 科技生活类
\end{itemize}
\end{large}
\vspace*{0.3cm}  % 项目间距
社员寄语
\end{Large}
\newpage  % 新的一页

\input{chapters/1_introduction.tex}  % 第一章：社团介绍
\input{chapters/2_activities.tex}  % 第二章：主要活动介绍
\input{chapters/3_qa.tex}  % 第三章：社团Q&A
\input{chapters/4_departments.tex}  % 第四章：分部介绍
\input{chapters/5_messages.tex}  % 第五章：社员寄语
\newpage

\end{document}